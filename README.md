# Memcached Loader
Приложение для парсинга и загрузки в memcache поминутной выгрузки логов трекера установленных приложений.

## Системные требования
- `golang` версии `1.20.1` или выше

## Установка

1. Склонируйте репозиторий:
```
git clone https://github.com/MegaDoge1337/go_memcached_loader.git
```

2. Перейдите в директорию с проектом:
```
cd go_memcached_loader
```

3. Установите зависимости:
```
go mod download
```

4. Используйте protobuf, чтобы скомпилировать protobuf-сообщение:
```
cd pb
protoc --go_out=. --go_opt=paths=source_relative appsinstalled.proto
```

5. Для полноценного использования, запустите сервисы memcache (см. `Развертывание memcached`)

## Проверка и тестирование

Запуск теста protobuf-сообщения можно выполнить с ключом `-test`:
```
go run main.go -test
```

## Запуск

Для запуска приложения выполните скрипт `main.go`:
```
go run main.go
```

Скрипт также имеет дополнительные параметры, которые можно указать при необходимости:
- `-test` - проверять корректность работы скомпилированного protobuf-сообщения;
- `-dry` - скрипт обработает данные без подключения и записи в memcached;
- `-pattern` - шаблон поиска файлов для парсинга, по умолчанию `./data/appsinstalled/*.tsv.gz`;
- `-idfa` - адрес memcached, по умолчанию `127.0.0.1:33013`;
- `-gaid` - адрес memcached, по умолчанию `127.0.0.1:33014`;
- `-adid` - адрес memcached, по умолчанию `127.0.0.1:33015`;
- `-dvid` - адрес memcached, по умолчанию `127.0.0.1:33016`.

## Данные

В директории `./data/appinstalled` содержится файл `sample.tsv` и его сжатый вариант `sample.tsv.gz`, который можно использовать для проверки работы программы. Представляет собой шаблон лога, который парсит скрипт.

## Развертывание memcached

Для запуска стандартных сервисов memcached для каждого типа устройств (`idfa`, `gaid`, `adid`, `dvid`) используйте `docker-compose.yml`. Он содержит 4 контейнера с `memcached`, привязанных к портам хоста по умолчанию (33013 - 33016).
